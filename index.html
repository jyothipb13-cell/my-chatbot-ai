<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My AI Chatbot</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .app-wrapper {
      display: none;
      flex-direction: column;
      width: 400px;
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
    }
    #logo-container img {
      display: block;
      margin: 0 auto 10px auto;
      width: 100px;
      height: auto;
      border-radius: 10px; /* optional: rounded corners */
    }
    #chat-container {
      height: 300px;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
    }
    .message { margin: 5px 0; }
    .user { text-align: right; color: blue; }
    .bot { text-align: left; color: green; }
    #controls { display: flex; gap: 10px; }
    #user-input { flex: 1; padding: 8px; }
    button { padding: 8px 12px; cursor: pointer; }
  </style>
</head>
<body>
  <!-- Loading & avatar screens -->
  <div id="loading-screen">Loading...</div>
  <div id="avatar-popup" style="display:none;">👋 Hi, I’m GenAI!</div>

  <!-- Main chatbot -->
  <div class="app-wrapper">
    <!-- Logo -->
    <div id="logo-container">
      <img src="logo.png" alt="My Chatbot Logo">
    </div>

    <div id="chat-container"></div>
    <div id="controls">
      <input type="text" id="user-input" placeholder="Type a message...">
      <button id="send-btn">Send</button>
      <button id="mic-btn">🎤</button>
    </div>
  </div>

  <script>
    const GEMINI_API_KEY = "AIzaSyC182XS-8uLPmK3x7jvTgW_x488Gsj0ezU"; // ⚠️ exposed in frontend
    const chatContainer = document.getElementById("chat-container");
    const userInput = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");
    const micBtn = document.getElementById("mic-btn");

    window.addEventListener("load", () => {
      const loading = document.getElementById("loading-screen");
      const avatar = document.getElementById("avatar-popup");
      const mainApp = document.querySelector(".app-wrapper");

      setTimeout(() => {
        loading.style.display = "none";
        avatar.style.display = "block";
        setTimeout(() => {
          avatar.style.display = "none";
          mainApp.style.display = "flex";
        }, 2000); 
      }, 1500);
    });

    function addMessage(text, sender, isHTML = false) {
      const msgDiv = document.createElement("div");
      msgDiv.classList.add("message", sender);
      msgDiv[isHTML ? "innerHTML" : "textContent"] = text;
      chatContainer.appendChild(msgDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function showTypingDots() {
      const dotsHTML = `
        <div class="message bot typing" id="typing">
          <div class="typing-dots">
            <span>⠋</span><span>⠙</span><span>⠹</span>
          </div>
        </div>`;
      chatContainer.insertAdjacentHTML("beforeend", dotsHTML);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function removeTypingDots() {
      const typing = document.getElementById("typing");
      if (typing) typing.remove();
    }

    sendBtn.addEventListener("click", async () => {
      const input = userInput.value.trim();
      if (!input) return;
      addMessage(input, "user");
      userInput.value = "";
      showTypingDots();
      try {
        const res = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              contents: [{ parts: [{ text: "You are a friendly AI bot. " + input }] }]
            }),
          }
        );
        const data = await res.json();
        const reply = data?.candidates?.[0]?.content?.parts?.[0]?.text || "⚠️ No response from Gemini.";
        removeTypingDots();
        addMessage(reply, "bot");
        const utter = new SpeechSynthesisUtterance(reply);
        speechSynthesis.speak(utter);
      } catch (err) {
        removeTypingDots();
        addMessage("⚠️ Error: Could not reach API.", "bot");
        console.error(err);
      }
    });

    micBtn.addEventListener("click", () => {
      if (!("webkitSpeechRecognition" in window)) {
        alert("Speech recognition not supported in this browser.");
        return;
      }
      const recognition = new webkitSpeechRecognition();
      recognition.lang = "en-IN";
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        userInput.value = transcript;
      };
      recognition.onerror = (event) => {
        console.error("Speech recognition error:", event);
        alert("Sorry, I could not hear. Please try again.");
      };
      recognition.start();
    });
  </script>
</body>
</html>
